@{
    var homeUrl = (ViewData["MainMenuUrl"]?.ToString()) ?? Url.Page("/FontIndex") ?? "/FontIndex";
    var hideOn = new[] { "/", "/fontindex" };
    var path   = (Context.Request.Path.Value ?? "").ToLowerInvariant();
    var show   = !hideOn.Contains(path);
}

@if (show)
{
    <button type="button" id="__btnBackToMenu" class="global-back-btn" title="返回主選單">
      <svg viewBox="0 0 16 16" aria-hidden="true" focusable="false" width="18" height="18" fill="currentColor">
        <path d="M8 .5 1 6v9a1 1 0 0 0 1 1h4.5v-5h3v5H14a1 1 0 0 0 1-1V6L8 .5Z"/>
        <path d="M13 2.5v2.708l2 1.6V2.5a1 1 0 0 0-1.555-.832L9.5 4.15 10.5 5l2.5-2.5Z"/>
      </svg>
    </button>

    <style>
      .global-back-btn{
        position: fixed;
        top: 3px;
        right: 3px;
        z-index: 2000;
        padding: 10px;
        border: 0;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #3b82f6;
        color: #fff;
        box-shadow: 0 6px 14px rgba(0,0,0,.2);
        cursor: pointer;
      }
      .global-back-btn:hover{ filter: brightness(0.95); }
    </style>

    <script>
      (function(){
        const btn = document.getElementById('__btnBackToMenu');
        if (!btn) return;
        btn.addEventListener('click', function(e){
          e.preventDefault(); e.stopPropagation();
          const url = '@homeUrl';
          const dirty = !!window.__unsavedChanges;
          if (!dirty) { location.href = url; return; }

          if (window.Swal) {
            Swal.fire({
              icon: 'question',
              title: '確定返回主選單？',
              text: '可能有尚未儲存的變更。',
              showCancelButton: true,
              confirmButtonText: '確認返回',
              cancelButtonText: '取消'
            }).then(r => { if (r.isConfirmed) location.href = url; });
          } else {
            if (confirm('可能有尚未儲存的變更，確定要返回主選單？')) location.href = url;
          }
        });
      })();
    </script>
}
