@{
    // 目標首頁（可由 ViewData 覆寫）
    var homeUrl = (ViewData["MainMenuUrl"]?.ToString()) ?? Url.Page("/FontIndex") ?? "/FontIndex";

    // 這些頁面不顯示返回按鈕（首頁/登入等可自行加）
    var hideOn = new[] { "/", "/fontindex" };
    var path   = (Context.Request.Path.Value ?? "").ToLowerInvariant();
    var show   = !hideOn.Contains(path);
}

@if (show)
{
    <button type="button" id="__btnBackToMenu" class="global-back-btn" title="返回主選單">主選單</button>

    <style>
      /* 全域固定在畫面最上方，不佔版位，不會觸發 submit */
      .global-back-btn{
        position: fixed;
        top: 10px;          /* 想放左上就把 right 換成 left */
        right: 14px;
        z-index: 2000;
        padding: 8px 14px;
        border: 0;
        border-radius: 10px;
        font-weight: 700;
        background: #3583dc;
        color: #fff;
        box-shadow: 0 6px 16px rgba(0,0,0,.2);
        cursor: pointer;
      }
      .global-back-btn:hover{ filter: brightness(0.95); }
    </style>

    <script>
      (function(){
        const btn = document.getElementById('__btnBackToMenu');
        if (!btn) return;
        btn.addEventListener('click', function(e){
          e.preventDefault(); e.stopPropagation();
          const url = '@homeUrl';

          // 若頁面有未儲存變更就提醒（_TableDetailPartial 內已有設定 __unsavedChanges；沒有也不會報錯）
          const dirty = !!window.__unsavedChanges;
          if (!dirty) { location.href = url; return; }

          if (window.Swal) {
            Swal.fire({
              icon: 'question',
              title: '確定返回主選單？',
              text: '偵測到尚未儲存的變更。',
              showCancelButton: true,
              confirmButtonText: '仍然返回',
              cancelButtonText: '取消'
            }).then(r => { if (r.isConfirmed) location.href = url; });
          } else {
            if (confirm('偵測到尚未儲存的變更，確定要返回主選單？')) location.href = url;
          }
        });
      })();
    </script>
}
