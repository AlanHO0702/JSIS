@model List<QueryFieldViewModel>
@{
    var condOps = new List<SelectListItem> {
        new("=", "="), new(">=", ">="), new("<=", "<="), new("like", "like")
    };
    int colCount = 2;
}

<form id="searchForm" method="post" class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title">查詢條件</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>
    <div class="modal-body">
        <div class="container-fluid">
            @for (int i = 0; i < Model.Count; i += colCount)
            {
                <div class="row">
                    @for (int j = 0; j < colCount && i + j < Model.Count; j++)
                    {
                        var field = Model[i + j];
                        // 1. 這裡直接產生唯一 key
                        var inputName = field.ColumnName + field.SortOrder;
                        var condName = "Cond_" + field.ColumnName + field.SortOrder;
                        <div class="col-6 mb-3">
                            <label>@field.ColumnCaption</label>
                            <div class="d-flex align-items-center gap-2">
                                <!-- 條件符號下拉 -->
                                <select name="@condName" class="form-select flex-grow-0" style="min-width:40px; max-width:80px; font-weight:bold">
                                    @foreach(var op in condOps)
                                    {
                                        if (field.DefaultEqual == op.Value)
                                        {
                                            <option value="@op.Value" selected>@op.Text</option>
                                        }  
                                        else
                                        {
                                            <option value="@op.Value">@op.Text</option>
                                        }
                                    }
                                </select>
                                @if (field.ControlType == 2)
                                {
                                    var options = ViewData[$"Option_{field.ColumnName}"] as List<SelectListItem> ?? new();
                                    <select name="@inputName" class="form-select">
                                        <option value="">--請選擇--</option>
                                        @foreach(var opt in options)
                                        if (field.DefaultValue == opt.Value)
                                            {
                                                <option value="@opt.Value" selected>@opt.Text</option>
                                            }
                                            else
                                            {
                                                <option value="@opt.Value">@opt.Text</option>
                                            }
                                        }
                                    </select>
                                }
                                else if (field.DataType == 1)
                                {
                                    <input type="date" name="@inputName" class="form-control" value="@field.DefaultValue" />
                                }
                                else if (field.DataType == 2)
                                {
                                    <input type="number" name="@inputName" class="form-control" value="@field.DefaultValue" />
                                }
                                else
                                {
                                    <input type="text" name="@inputName" class="form-control" value="@field.DefaultValue" />
                                }
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
    <div class="modal-footer">
        <button type="submit" class="btn btn-primary">查詢</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
    </div>
</form>
