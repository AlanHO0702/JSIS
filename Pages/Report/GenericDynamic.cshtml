@page "/Report/Generic/{itemId}"
@model GenericReportPageModel
@{
    Response.Headers["Cache-Control"] = "no-store, no-cache, must-revalidate, max-age=0";
    Response.Headers["Pragma"] = "no-cache";
    Response.Headers["Expires"] = "0";

    var itemId = (string?)RouteData.Values["itemId"] ?? string.Empty;
    Model.Config = Model.BuildReportConfigFromDb(itemId, expectedItemType: 2);
    if (Model.Config.OutputType != 6 && Model.Config.OutputType != 7)
    {
        throw new System.InvalidOperationException($"Item {itemId} not allowed (OutputType mismatch).");
    }

    Model.LoadDict(Model.Config.DictTableName);
    ViewData["ReportConfig"] = Model.Config;
    ViewData["Fields"] = Model.TableFields;
    ViewData["FieldDictList"] = Model.FieldDictList;
    ViewData["Title"] = Model.Config.Title;
}

@await Html.PartialAsync("~/Pages/Shared/_ReportScaffold.cshtml", Model, ViewData)
