@page
@model PcbErpApi.Pages.CUR.CurdBuModel
@{
    Layout = "_Layout";
}

<h3 class="text-primary fw-bold mb-3">公司基本資料設定</h3>

<!-- ✅ 共用表格畫面 -->
<partial name="~/Pages/Shared/_TableSingleGrid.cshtml" model="Model" />

<!-- ✅ 安全方式引入辭典 Modal -->
<div id="modal-host">
    @await Html.PartialAsync("~/Pages/Shared/_FieldDictModal.cshtml", Model.FieldDictList, ViewData)
</div>

@section Scripts {
    <!-- ✅ 一定要放在 section 裡 -->
    <script src="~/js/fieldDictModal.js?v=@DateTime.Now.Ticks"></script>
    <script>
        // ✅ 指定資料表名稱，讓 F3 與 modal 都知道是 CurdBu
        window._dictTableName = "CurdBu";

        // ✅ F3 快捷鍵開啟辭典設定
        document.addEventListener('keydown', e => {
            if (e.key === 'F3') {
                e.preventDefault();
                if (window.showDictModal) {
                    showDictModal('dictModal', window._dictTableName);
                } else {
                    console.warn('⚠️ 找不到 showDictModal，請確認 fieldDictModal.js 已載入');
                }
            }
        });

                // ✅ 自動清除殘留 backdrop
        document.addEventListener('hidden.bs.modal', function (event) {
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(b => b.remove());
            document.body.classList.remove('modal-open');
            document.body.style.removeProperty('overflow');
            document.body.style.removeProperty('padding-right');
        });

    </script>
}
