@page "/CUR/SingleGrid/{itemId}"
@model PcbErpApi.Pages.CUR.SingleGridModel
@using System.Text.Json
@{
    Layout = "_Layout";
    ViewData["Title"] = Model.PageTitle;
}

@* <h3 class="mb-3">@Model.HeaderText</h3> *@

<partial name="~/Pages/Shared/_TableSingleGrid.cshtml" model="Model" />

@await Html.PartialAsync("~/Pages/Shared/_FieldDictModal.cshtml", ViewData["FieldDictList"], ViewData)
@if (!string.IsNullOrWhiteSpace(Model.DictTableName))
{
    <script>window._dictTableName = '@Model.DictTableName';</script>
}
@if (ViewData["LoadError"] is string loadErr && !string.IsNullOrWhiteSpace(loadErr))
{
    <div class="alert alert-danger mt-2">資料載入錯誤：@loadErr</div>
}
<script>
  window._singleItemId = '@Model.ItemId';
  window._singleRealTable = '@Model.TableName';
  window._customButtons = @Html.Raw(JsonSerializer.Serialize(Model.CustomButtons ?? new()));
</script>
<script>
  (function() {
    const itemId = '@Model.ItemId';
    if (!itemId) return;
    const s = document.createElement('script');
    s.src = `/js/singlegrid/${encodeURIComponent(itemId)}.js`;
    s.async = true;
    s.onerror = function() { console.debug('no custom singlegrid script for', itemId); };
    document.head.appendChild(s);
  })();
</script>
<script src="~/js/fieldDictModal.js"></script>
