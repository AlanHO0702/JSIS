@page "/SPO/SPO00040"
@model PcbErpApi.Pages.SPO.SPO00040Model
@{
    Layout = "_Layout";
    ViewData["Title"] = Model.PageTitle;
    ViewData["EnableRowDelete"] = true;
    var partLabel = Model.ModeNum == 1 ? "品名" : "料號";
}

<div class="container-fluid px-3 py-3">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
        <div>
            <div class="fw-bold">@Model.PageTitle</div>
            @if (!string.IsNullOrWhiteSpace(Model.LoadError))
            {
                <div class="text-danger small">載入設定失敗：@Model.LoadError</div>
            }
        </div>
        <div class="btn-group">
            <button form="filterForm" type="submit" class="btn btn-primary btn-sm">查詢</button>
            <button form="filterForm" type="submit" class="btn btn-outline-secondary btn-sm">資料重取</button>
        </div>
    </div>

    <form id="filterForm" method="get" class="card shadow-sm mb-3">
        <div class="card-body">
            <div class="row g-3 align-items-end">
                <div class="col-12 col-md-4">
                    <label class="form-label d-block mb-1">狀態</label>
                    <div class="btn-group w-100" role="group" aria-label="Effect filter">
                        <input type="radio" class="btn-check" name="Effect" id="effect-valid" value="valid" checked="@(Model.Effect != "invalid" && Model.Effect != "all" ? "checked" : null)">
                        <label class="btn btn-outline-primary" for="effect-valid">生效</label>

                        <input type="radio" class="btn-check" name="Effect" id="effect-invalid" value="invalid" checked="@(Model.Effect == "invalid" ? "checked" : null)">
                        <label class="btn btn-outline-primary" for="effect-invalid">失效</label>

                        <input type="radio" class="btn-check" name="Effect" id="effect-all" value="all" checked="@(Model.Effect == "all" ? "checked" : null)">
                        <label class="btn btn-outline-primary" for="effect-all">不限</label>
                    </div>
                </div>

                <div class="col-12 col-md-4">
                    <label class="form-label mb-1">客戶</label>
                    <div class="input-group input-group-sm">
                        <select class="form-select" name="CustomerOp" disabled="@(Model.ModeNum == 1)">
                            <option value="=" selected="@((Model.CustomerOp ?? string.Empty).Equals("=", StringComparison.OrdinalIgnoreCase) ? "selected" : null)">=</option>
                            <option value="like" selected="@((Model.CustomerOp ?? string.Empty).Equals("like", StringComparison.OrdinalIgnoreCase) ? "selected" : null)">like</option>
                        </select>
                        <input type="text"
                               class="form-control"
                               name="Customer"
                               value="@Model.Customer"
                               list="customerList"
                               placeholder="公司代碼"
                               disabled="@(Model.ModeNum == 1)" />
                    </div>
                    <datalist id="customerList">
                        @foreach (var c in Model.Customers)
                        {
                            <option value="@c.Value">@c.Label</option>
                        }
                    </datalist>
                </div>

                <div class="col-12 col-md-4">
                    <label class="form-label mb-1">@partLabel</label>
                    <div class="input-group input-group-sm">
                        <select class="form-select" name="PartOp">
                            <option value="=" selected="@((Model.PartOp ?? string.Empty).Equals("=", StringComparison.OrdinalIgnoreCase) ? "selected" : null)">=</option>
                            <option value="like" selected="@((Model.PartOp ?? string.Empty).Equals("like", StringComparison.OrdinalIgnoreCase) ? "selected" : null)">like</option>
                        </select>
                        <input type="text"
                               class="form-control"
                               name="Part"
                               value="@Model.Part"
                               list="partList"
                               placeholder="@partLabel" />
                    </div>
                    <datalist id="partList">
                        @foreach (var p in Model.Parts)
                        {
                            <option value="@p.Value">@p.Label</option>
                        }
                    </datalist>
                    @if (Model.ModeNum == 1)
                    {
                        <div class="form-text">ModeNum=1：依品名篩選，不顯示客戶條件。</div>
                    }
                </div>
            </div>
            <input type="hidden" name="pageIndex" value="@Model.PageNumber" />
            <input type="hidden" name="pageSize" value="@Model.PageSize" />
        </div>
    </form>

    @if (!string.IsNullOrWhiteSpace(Model.LoadError))
    {
        <div class="alert alert-warning">無法載入資料：@Model.LoadError</div>
    }
    else
    {
        @await Html.PartialAsync("~/Pages/Shared/_TableSingleGrid.cshtml", new
        {
            TableName = Model.TableName,
            Items = Model.Items,
            TableFields = Model.TableFields,
            PageNumber = Model.PageNumber,
            PageSize = Model.PageSize,
            TotalCount = Model.TotalCount
        }, ViewData)
    }
</div>

<script>
  window._dictTableName = "@(ViewData["DictTableName"] ?? Model.DictTableName ?? Model.TableName)";
</script>

@await Html.PartialAsync("_FieldDictModal", Model.FieldDictList, ViewData)
<script src="~/js/fieldDictModal.js"></script>
