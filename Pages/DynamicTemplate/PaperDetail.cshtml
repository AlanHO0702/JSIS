@page "/DynamicTemplate/Paper/{itemId}/{paperNum}"
@model PcbErpApi.Pages.DynamicTemplate.PaperDetailModel
@{
    Layout = "_Layout";
    ViewData["Title"] = string.IsNullOrWhiteSpace(Model.ItemName) ? Model.ItemId : $"{Model.ItemId} {Model.ItemName}";
    ViewData["TableTitle"] = Model.PageTitle;
    ViewData["DictTableName"] = Model.DictTableName;
    ViewData["AddApiUrl"] = $"/api/DynamicTable/AddPaper/{Model.MasterDictTable}";
    ViewData["SubRouteTemplate"] = Model.DetailRouteTemplate;
    ViewData["QueryRedirectUrl"] = Url.Page("/DynamicTemplate/Paper", new { itemId = Model.ItemId }) ?? "/DynamicTemplate/Paper";
    ViewData["DeleteApiUrl"] = Model.MasterTable;
    ViewData["ReportSpName"] = Model.ReportSpName ?? "";
    ViewData["ActionRailPartial"] = Model.ActionRailPartial;
    ViewData["QueryFields"] = Model.QueryFields;
}

@await Html.PartialAsync("~/Pages/Shared/_TableDetailPartial.cshtml", Model)
@await Html.PartialAsync("~/Pages/Shared/_FieldDictModal.cshtml", Model.FieldDictList, ViewData)

<div class="text-muted small mt-2">
    DetailTable=@(ViewData["DetailTableName"] ?? "") | DetailCount=@(ViewData["DetailCount"] ?? "")
</div>

@if (ViewData["DetailLoadError"] is string derr && !string.IsNullOrWhiteSpace(derr))
{
    <div class="alert alert-warning mt-2">明細載入錯誤：@derr</div>
}

<script>window._dictTableName = "@Model.DictTableName";</script>
<script src="~/js/fieldDictModal.js"></script>
