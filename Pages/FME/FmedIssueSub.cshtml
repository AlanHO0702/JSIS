@page "{PaperNum}"
@model FMEdIssueSubModel
@{
    ViewData["TableTitle"] = $"製令單明細（{Model.MasterKey}）";
    ViewData["DictTableName"] = Model.TableName;
    ViewData["AddApiUrl"] = "/api/FMEdIssueMain";                 // 主檔 API（或 /api/FMEdIssueSub 若要新增明細）
    ViewData["SubRouteTemplate"] = "/FME/FMEdIssueSub/{PaperNum}";    // 明細頁路徑
    ViewData["QueryRedirectUrl"] = Url.Page("/FME/FMEdIssueMain");       // 返回的主頁面（製令單主檔）
    ViewData["DeleteApiUrl"] = "FMEdIssueMain";                   // 用於刪除主檔或明細的 API 名稱
    ViewData["ReportSpName"] = "FMEdIssuePaper_CIR";              // 對應報表名稱
    ViewData["ActionRailPartial"] = "~/Pages/FME/IssueSubCustomButton.cshtml"; // ← 指定本頁的按鈕
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<script>window._dictTableName = "@(ViewData["DictTableName"] ?? Model.TableName)";</script>

<!-- 保留單頭顯示和按鈕 -->
<div class="erp-detail-container">
    <!-- 單頭區域 -->
    @await Html.PartialAsync("~/Pages/Shared/_DetailHeaderSection.cshtml", Model)

    <!-- 多分頁單身區域 -->
    @await Html.PartialAsync("~/Pages/Shared/_MultiTabDetail.cshtml")
</div>

@await Html.PartialAsync("_FieldDictModal", Model.FieldDictList, ViewData)
<script src="~/js/fieldDictModal.js"></script>

@* 匯入訂單功能：IssueOrderPicker（製令單專用） *@
@await Html.PartialAsync("_IssueOrderPicker",
  new DetailPickerConfig{
      ModalId       = "issueDetailPicker",
      PaperNum      = Model.MasterKey,
      FetchApi      = "/api/IssueSubButton/fetch",
      InsertApi     = "/api/IssueSubButton/insert"
  })

<style>
/* 定義左側按鈕的空間變數（如果尚未定義） */
:root{
  --fab-left: 12px;
  --fab-width: 100px;
  --fab-gap: 20px;
  --rail-reserve: calc(var(--fab-left) + var(--fab-width) + var(--fab-gap));
}

/* 內容往右騰出空間給左側按鈕；toolbar 往回補，維持視覺對齊 */
.erp-detail-container{
    margin-left: var(--rail-reserve) !important;
    margin-right: 3vw !important;
    padding: 32px 0 !important;
}

#topToolbar{
    margin-left: calc(-1 * var(--rail-reserve)) !important;
    padding-left: 0 !important;
    justify-content: flex-start !important;
}

#topToolbar > .ms-2, #topToolbar .btn-toolbar{
    margin-left: 0 !important;
}

/* 確保頁籤不會被左側按鈕擋住 */
#headerTabs {
    position: relative;
    z-index: 1;
    margin-left: 0 !important;
}

.nav-tabs {
    margin-left: 0 !important;
}

/* 多分頁單身區域的樣式調整 */
.multi-tab-detail {
    margin-left: 0 !important;
    padding-left: 0 !important;
}
</style>
