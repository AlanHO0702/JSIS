# PCB åœ–æª”åŠŸèƒ½æ¸¬è©¦æŒ‡å—

## ğŸš€ æ‡‰ç”¨ç¨‹å¼å·²å•Ÿå‹•

**URL**: `http://localhost:5290`

---

## ğŸ“ æ¸¬è©¦æ¸…å–®

### âœ… éšæ®µ 1ï¼šåŸºæœ¬åŠŸèƒ½æ¸¬è©¦ï¼ˆç„¡éœ€è³‡æ–™åº«ï¼‰

#### 1.1 æ¸¬è©¦ç«¯é» - æ¸¬è©¦ç”¨è£æ¿åœ–
```
http://localhost:5290/test/panel
```
**é æœŸçµæœ**ï¼šé¡¯ç¤ºä¸€å¼µ 1200x800 çš„è£æ¿åœ–ï¼ŒåŒ…å«ï¼š
- å¤–æ¡†çŸ©å½¢ (1245 x 940)
- å…©æ¢å‚ç›´åˆ†å‰²ç·š (x=408, x=836)
- ä¸€æ¢æ°´å¹³åˆ†å‰²ç·š (y=428)
- å°ºå¯¸æ¨™è¨»å’Œç®­é ­

**æ¸¬è©¦æ–¹å¼**ï¼š
1. ç”¨ç€è¦½å™¨ç›´æ¥é–‹å•Ÿä¸Šè¿° URL
2. æˆ–ç”¨æŒ‡ä»¤ä¸‹è¼‰ï¼š
   ```bash
   curl http://localhost:5290/test/panel -o test_panel.jpg
   ```

#### 1.2 æ¸¬è©¦ç«¯é» - ä½”ä½åœ–
```
http://localhost:5290/test/placeholder
```
**é æœŸçµæœ**ï¼šé¡¯ç¤º 800x600 çš„ä½”ä½åœ–ï¼Œä¸­é–“æœ‰æ–‡å­—ã€Œé€™æ˜¯æ¸¬è©¦åœ–ç‰‡ã€

---

### ğŸ” éšæ®µ 2ï¼šAPI é è¦½æ¸¬è©¦ï¼ˆéœ€è¦è³‡æ–™åº«è³‡æ–™ï¼‰

#### 2.1 API ç«¯é»æ ¼å¼
```
GET /api/mappreview/{PartNum}/{Revision}/{type}?width={width}&height={height}
```

#### 2.2 åƒæ•¸èªªæ˜

| åƒæ•¸ | èªªæ˜ | ç¯„ä¾‹ | å¿…å¡« |
|------|------|------|------|
| `PartNum` | æ–™è™Ÿ | A01470005A | âœ… |
| `Revision` | ç‰ˆæ¬¡ | 0 | âœ… |
| `type` | åœ–å½¢é¡å‹ | panel, cut, pf, stackup | âœ… |
| `width` | åœ–ç‰‡å¯¬åº¦ | 800 | âŒ (é è¨­ 800) |
| `height` | åœ–ç‰‡é«˜åº¦ | 600 | âŒ (é è¨­ 600) |

#### 2.3 åœ–å½¢é¡å‹å°ç…§

| type åç¨± | type æ•¸å­— | MapKindNo | èªªæ˜ |
|-----------|----------|-----------|------|
| `panel` | `1` | 1 | è£æ¿åœ– |
| `cut` | `3` | 3 | æ’æ¿åœ– |
| `pf` | `9` | 9 | PFè£å‰ªåœ– |
| `stackup` | `0` | 0 | ç–Šæ§‹åœ– |

#### 2.4 æ¸¬è©¦ç¯„ä¾‹

**æ‚¨çš„æ¸¬è©¦ URLï¼ˆä¿®æ­£å¾Œï¼‰**ï¼š
```
http://localhost:5290/api/mappreview/A01470005A/0/panel?width=800&height=600
```

**å…¶ä»–ç¯„ä¾‹**ï¼š
```
# ä½¿ç”¨æ•¸å­—ä»£è¡¨é¡å‹
http://localhost:5290/api/mappreview/A01470005A/0/1?width=800&height=600

# æ’æ¿åœ–
http://localhost:5290/api/mappreview/A01470005A/0/cut

# PFè£å‰ªåœ–
http://localhost:5290/api/mappreview/A01470005A/0/pf

# ç–Šæ§‹åœ–
http://localhost:5290/api/mappreview/A01470005A/0/stackup?width=900&height=700
```

**å¦‚æœè³‡æ–™ä¸å­˜åœ¨**ï¼š
æœƒè¿”å›ä½”ä½åœ–ï¼Œé¡¯ç¤ºã€Œç„¡åœ–å½¢è³‡æ–™ã€è¨Šæ¯ã€‚

---

### ğŸ“Š éšæ®µ 3ï¼šMapData åˆ†ææ¸¬è©¦

#### 3.1 åˆ†æ API ç«¯é»
```
GET /api/mappreview/analyze/{PartNum}/{Revision}/{type}
```

#### 3.2 æ¸¬è©¦ç¯„ä¾‹
```
http://localhost:5290/api/mappreview/analyze/A01470005A/0/panel
```

**é æœŸçµæœ**ï¼šJSON æ ¼å¼çš„åˆ†æå ±å‘Š
```json
{
  "report": {
    "length": 1234,
    "lineCount": 56,
    "detectedFormat": "Delphi DFM",
    "separators": { "|": 10, ",": 25 },
    "keywords": { "Width": 5, "Height": 5 },
    "sampleNumbers": ["1245", "940", "408"],
    "notes": ["Found 3 coordinate pairs"]
  },
  "textReport": "=== MapData åˆ†æå ±å‘Š ===\n..."
}
```

---

### ğŸ’¾ éšæ®µ 4ï¼šåœ–æª”ç”¢ç”Ÿæ¸¬è©¦ï¼ˆå„²å­˜åˆ°ç¡¬ç¢Ÿï¼‰

#### 4.1 ç”¢ç”Ÿåœ–æª” API
```
POST /EMOdProdInfo/Detail?handler=GenerateImages
Content-Type: application/json

{
  "partNum": "A01470005A",
  "revision": "0"
}
```

#### 4.2 ä½¿ç”¨ curl æ¸¬è©¦
```bash
curl -X POST http://localhost:5290/EMOdProdInfo/Detail?handler=GenerateImages \
  -H "Content-Type: application/json" \
  -d "{\"partNum\":\"A01470005A\",\"revision\":\"0\"}"
```

#### 4.3 é æœŸå›æ‡‰
```json
{
  "success": true,
  "message": "æˆåŠŸç”¢ç”Ÿ 4 å¼µåœ–ç‰‡",
  "images": [
    {
      "type": "è£æ¿åœ–",
      "fileName": "A01470005A0_panel.jpg",
      "success": true
    },
    {
      "type": "æ’æ¿åœ–",
      "fileName": "A01470005A0_cut.jpg",
      "success": true
    },
    {
      "type": "PFè£å‰ªåœ–",
      "fileName": "A01470005A0_pf.jpg",
      "success": true
    },
    {
      "type": "ç–Šæ§‹åœ–",
      "fileName": "A01470005A0_stackup.jpg",
      "success": true
    }
  ]
}
```

---

## ğŸ“‚ åœ–ç‰‡å„²å­˜ä½ç½®

### é è¨­è·¯å¾‘
å¦‚æœæ²’æœ‰è¨­å®š `CURdSysParams`ï¼Œåœ–ç‰‡æœƒå„²å­˜åœ¨ï¼š
```
c:\JSProgram\JSIS\wwwroot\images\maps\
```

### è‡ªè¨‚è·¯å¾‘
ç³»çµ±æœƒå¾è³‡æ–™åº«è®€å–è·¯å¾‘è¨­å®šï¼š
```sql
SELECT Value FROM CURdSysParams
WHERE SystemId='EMO' AND ParamId='JpgPath'
```

### æª¢æŸ¥å„²å­˜è·¯å¾‘
æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼æ—¥èªŒï¼Œæœƒé¡¯ç¤ºå¯¦éš›ä½¿ç”¨çš„è·¯å¾‘ï¼š
```
LogInformation: Image saved: {Path}
```

### æª”åæ ¼å¼
```
{PartNum}{Revision}_{type}.jpg
```
ç¯„ä¾‹ï¼š
- `A01470005A0_panel.jpg`
- `A01470005A0_cut.jpg`
- `A01470005A0_pf.jpg`
- `A01470005A0_stackup.jpg`

---

## ğŸ” é™¤éŒ¯æ–¹æ³•

### 1. æª¢æŸ¥è³‡æ–™æ˜¯å¦å­˜åœ¨
```sql
-- æª¢æŸ¥ç”¢å“å·¥ç¨‹åœ–è³‡æ–™
SELECT PartNum, Revision, MapKindNo, SerialNum,
       LEN(MapData) as MapDataLength
FROM EMOdProdMap
WHERE PartNum = 'A01470005A' AND Revision = '0'

-- æª¢æŸ¥ç–Šæ§‹è³‡æ–™
SELECT PartNum, Revision, LayerId,
       LEN(MapData_1) as Len1,
       LEN(MapData_2) as Len2,
       LEN(MapData_3) as Len3
FROM EMOdLayerPress
WHERE PartNum = 'A01470005A' AND Revision = '0'
```

### 2. æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ
æ‡‰ç”¨ç¨‹å¼æœƒè¨˜éŒ„è©³ç´°çš„æ“ä½œæ—¥èªŒï¼š
- åœ–æª”ç”¢ç”Ÿéç¨‹
- éŒ¯èª¤è¨Šæ¯
- æª”æ¡ˆå„²å­˜è·¯å¾‘

### 3. æ¸¬è©¦ Swagger UI
è¨ªå•ï¼š
```
http://localhost:5290/swagger
```
å¯ä»¥ç›´æ¥åœ¨ UI ä¸Šæ¸¬è©¦ APIã€‚

---

## ğŸ“‹ æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### åŸºæœ¬åŠŸèƒ½
- [ ] `/test/panel` é¡¯ç¤ºæ­£å¸¸
- [ ] `/test/placeholder` é¡¯ç¤ºæ­£å¸¸

### API åŠŸèƒ½ï¼ˆä½¿ç”¨çœŸå¯¦æ–™è™Ÿï¼‰
- [ ] é è¦½ panel åœ–
- [ ] é è¦½ cut åœ–
- [ ] é è¦½ pf åœ–
- [ ] é è¦½ stackup åœ–
- [ ] åˆ†æ MapData

### åœ–æª”ç”¢ç”Ÿ
- [ ] POST GenerateImages æˆåŠŸ
- [ ] å››ç¨®åœ–æª”éƒ½æœ‰ç”¢ç”Ÿ
- [ ] æª”æ¡ˆå„²å­˜åœ¨æ­£ç¢ºä½ç½®
- [ ] æª”åæ ¼å¼æ­£ç¢º

### éŒ¯èª¤è™•ç†
- [ ] ä¸å­˜åœ¨çš„æ–™è™Ÿè¿”å›ä½”ä½åœ–
- [ ] éŒ¯èª¤çš„ type è¿”å›éŒ¯èª¤è¨Šæ¯
- [ ] ç¼ºå°‘åƒæ•¸è¿”å›éŒ¯èª¤è¨Šæ¯

---

## ğŸ¯ å¿«é€Ÿæ¸¬è©¦è…³æœ¬

### PowerShell è…³æœ¬
```powershell
# æ¸¬è©¦åŸºæœ¬ç«¯é»
Invoke-WebRequest -Uri "http://localhost:5290/test/panel" -OutFile "test_panel.jpg"
Invoke-WebRequest -Uri "http://localhost:5290/test/placeholder" -OutFile "test_placeholder.jpg"

Write-Host "åŸºæœ¬æ¸¬è©¦å®Œæˆï¼Œæª¢æŸ¥ç•¶å‰ç›®éŒ„çš„åœ–ç‰‡æª”æ¡ˆ"

# æ¸¬è©¦ APIï¼ˆè«‹æ›¿æ›æˆå¯¦éš›çš„æ–™è™Ÿï¼‰
$partNum = "A01470005A"
$revision = "0"

Invoke-WebRequest -Uri "http://localhost:5290/api/mappreview/$partNum/$revision/panel" -OutFile "api_panel.jpg"
Write-Host "API æ¸¬è©¦å®Œæˆ"

# æ¸¬è©¦åˆ†æ
Invoke-RestMethod -Uri "http://localhost:5290/api/mappreview/analyze/$partNum/$revision/panel" | ConvertTo-Json
```

### Curl è…³æœ¬ï¼ˆBash/CMDï¼‰
```bash
# åŸºæœ¬æ¸¬è©¦
curl -o test_panel.jpg http://localhost:5290/test/panel
curl -o test_placeholder.jpg http://localhost:5290/test/placeholder

# API æ¸¬è©¦
curl -o api_panel.jpg "http://localhost:5290/api/mappreview/A01470005A/0/panel?width=800&height=600"

# åˆ†ææ¸¬è©¦
curl "http://localhost:5290/api/mappreview/analyze/A01470005A/0/panel"

# ç”¢ç”Ÿåœ–æª”æ¸¬è©¦
curl -X POST http://localhost:5290/EMOdProdInfo/Detail?handler=GenerateImages \
  -H "Content-Type: application/json" \
  -d "{\"partNum\":\"A01470005A\",\"revision\":\"0\"}"
```

---

## â“ å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼çœ‹åˆ°çš„æ˜¯ä½”ä½åœ–ï¼Ÿ
**A**: æœ‰å¹¾ç¨®å¯èƒ½ï¼š
1. è³‡æ–™åº«ä¸­æ²’æœ‰è©²æ–™è™Ÿçš„ MapData
2. MapData ç‚º NULL æˆ–ç©ºå­—ä¸²
3. ä½¿ç”¨äº†éŒ¯èª¤çš„ type åƒæ•¸

**è§£æ±ºæ–¹å¼**ï¼š
1. ç”¨ SQL ç¢ºèªè³‡æ–™å­˜åœ¨
2. ç”¨ `/analyze` API æª¢æŸ¥ MapData
3. æª¢æŸ¥ type åƒæ•¸æ˜¯å¦æ­£ç¢º

### Q: åœ–æª”ç”¢ç”Ÿå¾Œæ‰¾ä¸åˆ°ï¼Ÿ
**A**: æª¢æŸ¥ä»¥ä¸‹ä½ç½®ï¼š
1. `c:\JSProgram\JSIS\wwwroot\images\maps\`
2. æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼æ—¥èªŒä¸­çš„å¯¦éš›è·¯å¾‘
3. ç¢ºèªè³‡æ–™å¤¾æœ‰å¯«å…¥æ¬Šé™

### Q: API è¿”å› 404ï¼Ÿ
**A**: ç¢ºèªï¼š
1. æ‡‰ç”¨ç¨‹å¼æ­£åœ¨é‹è¡Œ
2. URL æ ¼å¼æ­£ç¢ºï¼ˆæ³¨æ„å¤§å°å¯«ï¼‰
3. è·¯ç”±å·²æ­£ç¢ºè¨»å†Šï¼ˆæª¢æŸ¥ `http://localhost:5290/__routes`ï¼‰

### Q: åœ–ç‰‡é¡¯ç¤ºç©ºç™½ï¼Ÿ
**A**: å¯èƒ½åŸå› ï¼š
1. MapData è§£æå¤±æ•—
2. åœ–å½¢è³‡æ–™æ ¼å¼ä¸æ­£ç¢º
3. æ¸²æŸ“é‚è¼¯éœ€è¦èª¿æ•´

**è§£æ±ºæ–¹å¼**ï¼š
1. ç”¨ `/analyze` API æª¢æŸ¥ MapData æ ¼å¼
2. æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼æ—¥èªŒçš„éŒ¯èª¤è¨Šæ¯
3. ä½¿ç”¨æ¸¬è©¦ç«¯é»ç¢ºèªæ¸²æŸ“å¼•æ“æ­£å¸¸

---

## ğŸ“ æŠ€è¡“æ”¯æ´

### æŸ¥çœ‹æ‰€æœ‰è·¯ç”±
```
http://localhost:5290/__routes
```

### Swagger API æ–‡ä»¶
```
http://localhost:5290/swagger
```

### æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹
æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼æ˜¯å¦æ­£å¸¸é‹è¡Œï¼š
```
http://localhost:5290/
```

---

## âœ… æ¸¬è©¦æˆåŠŸæ¨™æº–

1. âœ… æ¸¬è©¦ç«¯é»è¿”å›æ­£å¸¸åœ–ç‰‡
2. âœ… API èƒ½æ­£ç¢ºé è¦½åœ–å½¢ï¼ˆæˆ–è¿”å›ä½”ä½åœ–ï¼‰
3. âœ… åˆ†æ API è¿”å›æœ‰æ•ˆçš„å ±å‘Š
4. âœ… ç”¢ç”Ÿçš„åœ–æª”å„²å­˜åœ¨æ­£ç¢ºä½ç½®
5. âœ… éŒ¯èª¤è™•ç†æ­£å¸¸ï¼ˆä¸æœƒå´©æ½°ï¼‰

---

**ç¥æ¸¬è©¦é †åˆ©ï¼** ğŸ‰

å¦‚æœé‡åˆ°å•é¡Œï¼Œè«‹ï¼š
1. æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ
2. ä½¿ç”¨ `/analyze` API äº†è§£ MapData æ ¼å¼
3. ç¢ºèªè³‡æ–™åº«ä¸­æœ‰ç›¸æ‡‰çš„è³‡æ–™
